<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CCTV Manager â€” Multi-Device Sync</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#f5f5f5; padding:40px; }
  h2 { color:#333; margin-bottom:20px; }
  #searchInput { padding:12px 15px; width:100%; max-width:400px; border-radius:10px; border:1px solid #ccc; font-size:16px; margin-bottom:30px; outline:none; transition:.2s; }
  #searchInput:focus { border-color:#007bff; box-shadow:0 0 5px rgba(0,123,255,0.3); }
  #addSection input { padding:10px 12px; width:250px; border-radius:8px; border:1px solid #ccc; margin-right:10px; margin-bottom:15px; font-size:14px; }
  #addSection button { padding:10px 16px; font-size:14px; border:none; border-radius:8px; cursor:pointer; background-color:#28a745; color:white; transition:.2s; }
  #addSection button:hover { background-color:#218838; }
  #buttonContainer { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
  .btn-container { background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); display:flex; flex-direction:column; transition:.2s; }
  .btn-container:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.2); }
  .btn-link { flex:1; padding:20px; font-size:16px; font-weight:bold; color:white; background:#007bff; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; }
  .btn-link:hover { background:#0056b3; }
  .btn-actions { display:flex; }
  .btn-actions button { flex:1; padding:12px 0; font-size:14px; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:.2s; }
  .btn-edit { background:#ffc107; color:white; }
  .btn-edit:hover { background:#e0a800; }
  .btn-delete { background:#dc3545; color:white; }
  .btn-delete:hover { background:#a71d2a; }
  .btn-actions i { margin-right:6px; }
</style>
</head>
<body>

<h2>Search CCTV Cameras</h2>
<input type="text" id="searchInput" placeholder="Search cameras..." onkeyup="searchButtons()">

<div id="addSection">
  <h2>Add New Camera</h2>
  <input type="text" id="btnName" placeholder="Camera Name">
  <input type="text" id="btnLink" placeholder="Stream URL">
  <button onclick="handleAddButton()"><i class="fas fa-plus"></i> Add Camera</button>
</div>

<h2>Camera List</h2>
<div id="buttonContainer"></div>

<!-- Firebase v12 Modular SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBFoiQAkhjxVH3WRDjLYx_STuMndK-Z2YY",
    authDomain: "cctvmanager.firebaseapp.com",
    databaseURL: "https://cctvmanager-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "cctvmanager",
    storageBucket: "cctvmanager.firebasestorage.app",
    messagingSenderId: "981385358434",
    appId: "1:981385358434:web:21379e539d07031633f53b"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const camerasRef = ref(db, 'cameras');

  // Add new camera
  window.handleAddButton = function() {
    const name = document.getElementById("btnName").value.trim();
    const link = document.getElementById("btnLink").value.trim();
    if (!name || !link) { alert("Enter both name and URL"); return; }
    push(camerasRef, { name, link });
    document.getElementById("btnName").value = "";
    document.getElementById("btnLink").value = "";
  }

  // Render a camera button card
  function renderButton(key, data) {
    const container = document.createElement("div");
    container.className = "btn-container";
    container.id = key;

    const btn = document.createElement("button");
    btn.className = "btn-link";
    btn.innerHTML = `<i class="fas fa-video"></i> ${data.name}`;
    btn.onclick = () => window.open(data.link, "_blank");

    const actions = document.createElement("div");
    actions.className = "btn-actions";

    const editBtn = document.createElement("button");
    editBtn.className = "btn-edit";
    editBtn.innerHTML = `<i class="fas fa-edit"></i> Edit`;
    editBtn.onclick = () => {
      const newName = prompt("Edit camera name:", data.name);
      if (newName === null) return;
      const newLink = prompt("Edit camera URL:", data.link);
      if (newLink === null) return;
      update(ref(db, 'cameras/' + key), { name: newName, link: newLink });
    }

    const delBtn = document.createElement("button");
    delBtn.className = "btn-delete";
    delBtn.innerHTML = `<i class="fas fa-trash-alt"></i> Delete`;
    delBtn.onclick = () => {
      if (confirm(`Delete camera "${data.name}"?`)) {
        remove(ref(db, 'cameras/' + key));
      }
    }

    actions.appendChild(editBtn);
    actions.appendChild(delBtn);
    container.appendChild(btn);
    container.appendChild(actions);
    document.getElementById("buttonContainer").appendChild(container);
  }

  // Real-time sync
  onValue(camerasRef, snapshot => {
    document.getElementById("buttonContainer").innerHTML = "";
    const cameras = snapshot.val();
    if (cameras) {
      Object.keys(cameras).forEach(key => renderButton(key, cameras[key]));
    }
  });

  // Search functionality
  window.searchButtons = function() {
    const filter = document.getElementById("searchInput").value.toUpperCase();
    const containers = document.getElementsByClassName("btn-container");
    for (let i = 0; i < containers.length; i++) {
      const btn = containers[i].querySelector(".btn-link");
      containers[i].style.display = btn.innerText.toUpperCase().includes(filter) ? "flex" : "none";
    }
  }

</script>
</body>
</html>
